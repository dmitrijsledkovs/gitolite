<p><head><style>
    body        { margin-left:  40px;   font-size:  0.9em;  font-family: sans-serif; max-width: 800px; }
    h1          { margin-left: -30px;   border-bottom: 5px  solid #ccc; }
    h2, h3      { margin-left: -30px;   border-top:    3px  solid #ddd; }
    h4, h5      { margin-left: -20px; }
    code        { font-size:    1.1em;  background:  #eee; }
    pre         { margin-left:  2em;    background:  #eee; }
    pre code    { font-size:    1.1em;  background:  #eee; }
</style></head></p>

<h2>delegating access control responsibilities</h2>

<p>[Thanks to jeromeag for forcing me to think through this...]</p>

<hr />

<p>In this document:</p>

<ul>
<li><a href="#_lots_of_repos_lots_of_users">lots of repos, lots of users</a></li>
<li><a href="#_splitting_up_the_set_of_repos_into_groups">splitting up the set of repos into groups</a></li>
<li><a href="#_delegating_ownership_of_groups_of_repos">delegating ownership of groups of repos</a></li>
<li><a href="#_other_notes">other notes</a></li>
<li><a href="#_security_philosophy_note">security/philosophy note</a></li>
</ul>

<hr />

<p><a name="_lots_of_repos_lots_of_users"></a></p>

<h3>lots of repos, lots of users</h3>

<p>Gitolite tries to make it easy to manage access to lots of users and repos,
exploiting commonalities wherever possible.  It lets you specify bits and
pieces of the access control separately -- i.e., <em>all</em> the access specs for a
certain repo need not be together; they can be scattered, which makes it
easier to manage the sort of slice and dice needed in that example.</p>

<p>But eventually the config file will become too big.  If you let only one
person have control, he could become a bottleneck.  If you give it to multiple
people, they might make mistakes or stomp on each others' work accidentally.</p>

<p>The best way is to divide up the config file and give parts of it to different
people.</p>

<p>Ideally, we would delegate authority for <em>groups</em> of repos, not individual
repos, otherwise it doesn't scale.  It would also be nice if we could prevent
an admin from creating access rules for <em>any</em> repo in the system -- i.e., set
limits on what repos he can control.  This would be a nice "security" feature.</p>

<p>Delegation offers a way to do all that.  Note that delegated admins cannot
create or remove users, nor can they define new repos.  They can only define
access control rules for a set of repos they have been given authority for.</p>

<hr />

<p>It's easier to show how it all works with an example instead of long
descriptions.</p>

<p><a name="_splitting_up_the_set_of_repos_into_groups"></a></p>

<h3>splitting up the set of repos into groups</h3>

<p>To start with, recall that gitolite allows you to specify <strong>groups</strong> (of users
or repos, same syntax).  So the basic idea is that the main config file
(<code>conf/gitolite.conf</code> in your admin repo clone) will specify some repo groups:</p>

<pre><code># group your projects/repos however you want
@webbrowser_repos           = firefox lynx
@webserver_repos            = apache nginx
@malware_repos              = conficker storm

# any other config as usual, including access control lines for any of the
# above projects or groups
</code></pre>

<p><a name="_delegating_ownership_of_groups_of_repos"></a></p>

<h3>delegating ownership of groups of repos</h3>

<p>Once the repos are grouped, give each person charge of one or more groups.
For example, Alice may be in charge of all web browser development projects,
Bob takes care of web servers, and Mallory, as <a href="http://en.wikipedia.org/wiki/Alice_and_Bob#List_of_characters">tradition</a> dictates, is
in charge of malware ;-)</p>

<p>You do this by adding files with specific names to the <code>gitolite-admin</code> repo:</p>

<pre><code># the admin repo access was probably like this to start with:
repo gitolite-admin
    RW+                                         = sitaram
# now add these lines to the config for the admin repo
    RW                                          = alice bob mallory
    RW+ NAME/                                   = sitaram
    RW  NAME/conf/fragments/webbrowser_repos    = alice
    RW  NAME/conf/fragments/webserver_repos     = bob
    RW  NAME/conf/fragments/malware_repos       = mallory
</code></pre>

<p>This uses gitolite's ability to restrict pushes by file/dir name being changed
-- the syntax you see above ensures that, while "sitaram" does not have any
NAME based restrictions, the other 3 users do.  See <code>conf/example.conf</code> for
syntax and notes.</p>

<p>As you can see, <strong>for each repo group</strong> you want to delegate authority over,
there's a rule for a <strong>corresponding file</strong> in <code>conf/fragments</code> in the
<code>gitolite-admin</code> repo.  If you have write access to that file, you are allowed
to define rules for repos in that repo group.</p>

<p>In other words, we use gitolite's file/dir NAME-based permissions to "enforce"
the separation between the delegated configs!</p>

<p>Here's how to use this in practice:</p>

<ul>
<li><p>Alice clones the <code>gitolite-admin</code> repo, and adds a file called
<code>conf/fragments/webbrowser_repos.conf</code></p></li>
<li><p>she writes in this file any access control rules for the "firefox" and
"lynx" repos.  She should not write access rules for any other project --
they will be ignored</p></li>
<li><p>Alice then commits and pushes to the <code>gitolite-admin</code> repo</p></li>
</ul>

<p>Naturally, a successful push invokes the post-update hook that the admin repo
has, which eventually runs the compile script.  The <strong>net effect</strong> is as if
you appended the contents of all the "fragment" files, in alphabetical order,
to the bottom of the main file.</p>

<p><a name="_other_notes"></a></p>

<h3>other notes</h3>

<p>The "include" statement cannot be used in fragment files, for security
reasons.</p>

<hr />

<p><a name="_security_philosophy_note"></a></p>

<h3>security/philosophy note</h3>

<p>The delegation feature is meant only for access control rules, not pubkeys.
Adding/removing pubkeys is a much more significant event than changing branch
level permissions for people already on staff, and only the main admin should
be allowed to do it.</p>

<p>Gitolite's "userids" all live in the same namespace.  This is unlikely to
change, so please don't ask -- it gets real complicated to do otherwise.
Allowing delegated admins to add users means username collisions, which also
means security problems (admin-A creates a pubkey for Admin-B, thus gaining
access to all of Admin-B's stuff).</p>

<p>If you feel the need to delegate even that, please just go the whole hog and
give them separate gitolite instances!  It's pretty easy to setup the
<em>software</em> itself system-wide, so that many users can use it without all the
"easy install" fuss.  See the "system install / user setup" section in
doc/1-INSTALL.mkd for details.</p>
